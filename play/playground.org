* OSCAL Playground

** NIST SP 800-53 rev5

#+property: header-args :var FILE="../NIST/oscal-content/nist.gov/SP800-53/rev5/yaml/NIST_SP-800-53_rev5_catalog.yaml"

*** Display control groupings

#+begin_src python :results output :exports both
import yaml

with open(FILE, 'r') as file:
    catalog = yaml.safe_load(file).get('catalog')
    groups = catalog.get('groups')
    print(f"Groups: {len(groups)}")
    for g in groups:
        print(f"    {g['id']}: {len(g['controls']):2} - {g['title']}")

    total = sum([len(g['controls']) for g in groups])
    print(f"Total controls: {total}")
#+end_src

#+RESULTS:
#+begin_example
Groups: 20
    ac: 25 - Access Control
    at:  6 - Awareness and Training
    au: 16 - Audit and Accountability
    ca:  9 - Assessment, Authorization, and Monitoring
    cm: 14 - Configuration Management
    cp: 13 - Contingency Planning
    ia: 13 - Identification and Authentication
    ir: 10 - Incident Response
    ma:  7 - Maintenance
    mp:  8 - Media Protection
    pe: 23 - Physical and Environmental Protection
    pl: 11 - Planning
    pm: 32 - Program Management
    ps:  9 - Personnel Security
    pt:  8 - Personally Identifiable Information Processing and Transparency
    ra: 10 - Risk Assessment
    sa: 23 - System and Services Acquisition
    sc: 51 - System and Communications Protection
    si: 23 - System and Information Integrity
    sr: 12 - Supply Chain Risk Management
Total controls: 323
#+end_example

*** Count of sub controls

#+begin_src sh :results output
yq '[.catalog.groups[] | .controls[] | .controls[]] | length' ${FILE}
#+end_src

#+RESULTS:
: 870

** DoD Zero Trust Overlays

*** Scripted Extraction

#+header: :var file="Downloads/ZeroTrustOverlays-2024Feb.pdf"
#+begin_src python :results output :dir "~/"
from pypdf import PdfReader
import re

reader = PdfReader(file)
pattern = re.compile(r'^ ?(\w+-\d+(\(\d+\))?)')

# Appendix A - Control Tables Allocated to Pillars

# pages = range(43, 65)
# columns=['Enabler', 'User', 'Device', 'App/Workload',
#          'Data', 'Net/Env', 'Auto/Orch', 'Vis/Analytics']
# mappings = {
#     44: [89, 95, 102, 108, 114, 120, 127, 133],
#     45: [-1, 97, 104, 110, 117, -1, 129, 136],
#     46: [69],
#     47: [85, 91, 98, 105, 111, -1, 124, 131],
#     48: [77, -1, -1, 101, -1, 117],
#     49: [88, -1, 100, 106, -1, 118],
#     50: [83, -1, -1, -1, -1, -1, -1, 128],
#     51: [75, 83, 92, 100, -1, -1, 125],
#     52: [-1, 91, 100, -1, -1, -1, -1, 146],
#     53: [90, -1, -1, -1, -1, -1, 128, 134],
#     54: [],
#     55: [84, 91],
#     56: [85, 91, -1, 103, -1, -1, -1, 127],
#     57: [69, 78],
#     58: [83, -1, -1, -1, 109, -1, 122],
#     59: [84, 91, 97, 104, 110, -1, 124, 130],
#     60: [79, -1, -1, 102, -1, -1, 125],
#     61: [88, 94, 101, 107, 114, 120, -1, 133],
#     62: [-1, 97, 104, 111, 117, 124, 131, 137],
#     63: [89, 96, 103, 110, 117, 123, 130, 137],
#     64: [-1, -1, 111, 118, 125, 133, 140, 147],
#     65: [82, -1, -1, 101],
# }

# Appendix B - Execution Enabler Overlay

pages = range(67, 69)
columns = ['Doctrine', 'Organization', 'Training', 'Materiel', 'Leadership and education',
           'Personnel', 'Facilities', 'Policy']
mappings = {
    68: [-1, 93, 100, 108, 116, 123],
    69: [-1, 87, 94],
}

# Appendix C - User Pillar Overlay

# pages = range(84, 90)
# columns = ['1.1 User Inventory', '1.2 Conditional User Access', '1.3 Multi-Factor Authentication (MFA)',
#            '1.4 Privileged Access Management (PAM)', '1.5 Identity Federation & User Credentialing',
#            '1.6 Behavioral, Contextual ID, and Biometrics', '1.7 Least Privileged Access',
#            '1.8 Continuous Authentication', '1.9 Integrated ICAM Platform']
# mappings = {
#     85: [65, 76, 86, 98, 108, 119, 129, -1, 151],
#     86: [65, 76, 87, 98, 109, -1, 130, -1, 152],
#     87: [63, 74, 85, 95, 106, 116, 127, 137, 148],
#     88: [67, 78, 89, 100, 111, 122, 133, 144, 155],
#     89: [-1, 78, 89, 100, 111, 122, 133, 144, 155],
#     90: [-1, -1, -1, 88, -1, 108],
# }

# Appendix D - Device Pillar Overlay

# pages = range(153, 156)
# columns = ['2.1 Device Inventory', '2.2 Device Detection and Compliance',
#            '2.3 Device Authorization w/ Real Time Inspection',
#            '2.4 Remote Access',
#            '2.5 Partially & Fully Automated Asset, Vulnerability and Patch Mgmt',
#            '2.6 UEM & MDM', '2.7 EDR & XDR']
# mappings = {
#     153: [72, 84, 95, 107, 119, 130, 131, 142],
#     154: [70, 82, 94, 105, 117, 128, 140],
#     155: [73, 85, 97, 109, 121, 133, 145],
#     156: [73, 84, 96, 108, 120, 132, 143],
# }

# Appendix E - Application & Workload Pillar Overlay

# pages = range(208, 212)
# columns = ['3.1 Application Inventory', '3.2 Secure Software Development & Integration',
#            '3.3 Software Risk Management', '3.4 Resource Authorization & Integration',
#            '3.5 Continuous Monitoring and Ongoing Authorizations']
# mappings = {
#     209: [-1, 105, 118, 130],
#     210: [91, 103, 115, 128, 140],
#     211: [-1, 105, 118, 130],
#     212: [-1, 106, 118, 130]
# }

# Appendix F - Data Pillar Overlay

# pages = range(255,258)
# columns = ['4.1 Data Catalog Risk Alignment', '4.2 DoD Enterprise Data Governance',
#            '4.3 Data Labeling and Tagging', '4.4 Data Monitoring and Sensing',
#            '4.5 Data Encryption & Rights Management', '4.6 Data Loss Prevention',
#            '4.7 Data Access Control']
# mappings = {
#     256: [-1, 87, 99, 111, 123, 135, 148],
#     257: [74, 87, 99, 111, 123, 135],
#     258: [-1, -1, 90, 101, 112, 124]
# }

# Appendix G - Network & Environment Pillar Overlay

# pages = range(295, 297)
# columns = ['5.1 Data Flow Mapping', '5.2 Software Defined Networking (SDN)',
#            '5.3 Macro-segmentation', '5.4 Micro-segmentation']
# mappings = {
#     296: [102, 112, 123, 132],
#     297: [105, 116, 126, 136],
# }

# Appendix H Automation & Orchestration Pillar Overlay

# pages = range(319,322)
# columns = ['6.1 Policy Decision Point & Policy Orchestration', '6.2 Critical Process Automation',
#            '6.3 Machine Learning', '6.4 Artificial Intelligence',
#            '6.5 Security Orchestration, Automation & Response', '6.6 API Standardization',
#            '6.7 Security Operations Center & Incident Response']
# mappings = {
#     320: [86, -1, 106, -1, 127],
#     321: [89, 99, 110, 120, 131, -1, 152],
#     322: [-1, -1, -1, -1, -1, 1, 129],
# }

# Appendix I Visibility & Analytics Pillar Overlay

# pages = range(351,355)
# columns = ['7.1 Log All Traffic (Network, Data, Apps, Users)',
#            '7.2 Security Information and Event Management (SIEM)',
#            '7.3 Common Security and Risk Analytics',
#            '7.4 User and Entity Behavior Analytics',
#            '7.5 Threat Intelligence Integration',
#            '7.6 Automated Dynamic Policies']
# mappings = {
#     352: [-1, 90, 101, 112, -1, 134],
#     353: [86, 97, 109, -1, 132, 144],
#     354: [87, 99, 111, 123, 135, 147],
#     355: [-1, 91, -1, -1, 124, 135],
# }

for p in pages:
    page = reader.pages[p]
    text = page.extract_text(extraction_mode="layout", layout_mode_strip_rotated=False)

    indices = mappings[p+1]

    data_column = 0
    found = set()
    for line in text.splitlines():
        m = pattern.match(line)
        if m:
            # x_marks = [pos for pos, char in enumerate(line) if char == 'X']
            # found = found | set(x_marks)

            x_marks = [index for index, pos in enumerate(indices) if 'X' in line[pos-1:pos+1]]
            categories = [columns[index] for index in x_marks]
            print(f'{m.group(1):>10}, {categories}')

    # print(f'    {p+1}: {sorted(found)},')
#+end_src

#+RESULTS:
#+begin_example
  AC-2(12), ['Organization']
      AT-2, ['Training']
      AT-3, ['Training']
      CP-2, []
   CP-2(5), ['Organization']
   CP-2(6), ['Organization']
      PL-2, ['Organization']
      PL-7, ['Organization']
      PL-8, ['Organization']
   PL-8(1), ['Organization']
      PL-9, ['Organization']
      PM-1, ['Organization']
      PM-2, ['Leadership and education']
      PM-3, ['Materiel']
      PM-6, ['Leadership and education']
      PM-7, ['Organization']
      PM-9, ['Organization', 'Leadership and education']
     PM-13, ['Personnel']
     PM-14, ['Organization']
     PM-18, ['Leadership and education']
     PM-19, ['Leadership and education']
     PM-28, ['Organization', 'Leadership and education']
     PM-29, ['Leadership and education']
     PM-30, ['Organization']
     PM-31, ['Organization']
     PM-32, ['Organization']
      PS-2, ['Personnel']
      PS-3, ['Personnel']
      PS-4, ['Personnel']
   PS-4(2), ['Personnel']
      PS-5, ['Personnel']
      RA-3, ['Organization']
      RA-5, ['Organization']
      RA-7, ['Organization']
      RA-9, ['Organization']
     RA-10, ['Organization']
     SA-11, []
  SA-11(2), ['Organization']
     SA-16, ['Training']
#+end_example

*** Example Page

#+begin_example
A.1      Allocation of Access Control Controls to Zero Trust
         Pillars/Enabler
       Table A-1. Access Control (AC) Family Controls Allocated to Zero Trust Pillars/Enabler

                                                                                                      Pillars/Enablers


                                                                                                              ad           ent   tration
                               Applicable Controls                                                            rklo         nm    rches lytics
                                                                                                                           nviro
                                                                                                              tion & Wo    & E   tion & O & Ana
                                                                                                        ice   ica          rk    oma   lity
                                                                                                                    ta     wo          ibi
                                                                                           Enabler User Dev   Appl  Da     Net   Aut   Vis
 AC-1             Policy and Procedures                                                  X                                     X
 AC-2             Account Management                                                           X      X     X                  X
 AC-2(1)          Automated System Account Management                                          X
 AC-2(2)          Automated Temporary and Emergency Account                                    X
                  Management
 AC-2(3)          Disable Accounts                                                             X
 AC-2(4)          Automated Audit Actions                                                      X
 AC-2(6)          Dynamic Privilege Management                                                 X      X                              X
 AC-2(7)          Privileged User Accounts                                                     X
 AC-2(8)          Dynamic Account Management                                                   X
 AC-2(9)          Restrictions on Use of Shared and Group Accounts                             X
 AC-2(11)         Usage Conditions                                                             X                               X     X
 AC-2(12)         Account Monitoring for Atypical Usage                                  X     X                                     X
 AC-2(13)         Disable Accounts for High-risk Individuals                                   X
 AC-3             Access Enforcement                                                           X      X     X     X     X            X
 AC-3(7)          Role-based Access Control                                                    X      X                 X
 AC-3(8)          Revocation of Access Authorizations                                          X      X                              X
 AC-3(10)         Audited Override of Access Control Mechanisms                                X
 AC-3(11)         Restrict Access to Specific Information Types                                X      X           X                  X
 AC-3(12)         Assert and Enforce Application Access                                                     X
 AC-3(13)         Attribute-based Access Control                                               X      X     X     X     X            X
 AC-4             Information Flow Enforcement                                                              X     X     X
 AC-4(1)          Object Security and Privacy Attributes                                                    X     X     X
 AC-4(2)          Processing Domains                                                                                    X
 AC-4(3)          Dynamic Information Flow Control                                                          X     X     X      X
 AC-4(6)          Metadata                                                                                        X     X      X
 AC-4(8)          Security and Privacy Policy Filters                                                       X     X     X      X
 AC-4(10)         Enable and Disable Security or Privacy Policy Filters                                     X     X            X
 AC-4(11)         Configuration of Security or Privacy Policy Filters                                       X     X     X      X
 AC-4(12)         Data Type Identifiers                                                                           X     X
 AC-4(17)         Domain Authentication                                                                     X           X
 AC-4(19)         Validation of Metadata                                                                          X     X      X
 AC-4(21)         Physical or Logical Separation of Information Flows                                                   X
 AC-4(23)         Modify Non-releasable Information                                                               X
 AC-4(26)         Audit Filtering Actions                                                                         X
 AC-4(29)         Filter Orchestration Engines                                                                                 X

                                                                  A-2

#+end_example
